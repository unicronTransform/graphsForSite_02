<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gauss Map Dual Plot (Interactive)</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<h2>Gauss Map Dual Plot (Interactive)</h2>

<label>Frequency:
  <input type="range" id="freqSlider" min="0.5" max="5.0" step="0.1" value="1.0">
</label>
<label>Amplitude:
  <input type="range" id="ampSlider" min="0.5" max="5.0" step="0.1" value="1.0">
</label>

<div id="plot" style="width: 100%; height: 800px;"></div>

<script>
function computeData(freq, amp) {
  const N = 20;
  const x = [], y = [], z = [], u = [], v = [], w = [];
  const sphereNormals = [];

  for (let i = 0; i < N; i++) {
    const xi = -1 + 2 * i / (N - 1);
    for (let j = 0; j < N; j++) {
      const yj = -1 + 2 * j / (N - 1);

      const f = amp * Math.sin(freq * Math.PI * xi) * Math.cos(freq * Math.PI * yj);
      const dfdx = amp * freq * Math.PI * Math.cos(freq * Math.PI * xi) * Math.cos(freq * Math.PI * yj);
      const dfdy = -amp * freq * Math.PI * Math.sin(freq * Math.PI * xi) * Math.sin(freq * Math.PI * yj);

      const nx = -dfdx, ny = -dfdy, nz = 1;
      const norm = Math.sqrt(nx * nx + ny * ny + nz * nz);
      const n = [nx / norm, ny / norm, nz / norm];

      x.push(xi);
      y.push(yj);
      z.push(f);
      u.push(n[0]);
      v.push(n[1]);
      w.push(n[2]);

      sphereNormals.push({ x: n[0], y: n[1], z: n[2] });
    }
  }

  return { x, y, z, u, v, w, sphereNormals };
}

function plotGaussMap(freq, amp) {
  const { x, y, z, u, v, w, sphereNormals } = computeData(freq, amp);

  const surfaceTrace = {
    type: 'mesh3d',
    x: x,
    y: y,
    z: z,
    opacity: 0.7,
    colorscale: 'Viridis',
    showscale: false
  };

  const normalsTrace = {
    type: 'cone',
    x: x,
    y: y,
    z: z,
    u: u,
    v: v,
    w: w,
    sizemode: 'absolute',
    sizeref: 0.3,
    anchor: 'tail',
    colorscale: [[0, 'red'], [1, 'red']],
    showscale: false
  };

  const sphereTheta = [], spherePhi = [], sphereX = [], sphereY = [], sphereZ = [];
  for (let i = 0; i < 30; i++) {
    const theta = 2 * Math.PI * i / 30;
    for (let j = 0; j < 30; j++) {
      const phi = Math.PI * j / 30;
      sphereTheta.push(theta);
      spherePhi.push(phi);
      sphereX.push(Math.sin(phi) * Math.cos(theta));
      sphereY.push(Math.sin(phi) * Math.sin(theta));
      sphereZ.push(Math.cos(phi));
    }
  }

  const sphereTrace = {
    type: 'mesh3d',
    x: sphereX,
    y: sphereY,
    z: sphereZ,
    opacity: 0.3,
    color: 'lightblue'
  };

  const normalPoints = {
    type: 'scatter3d',
    mode: 'markers',
    x: sphereNormals.map(p => p.x),
    y: sphereNormals.map(p => p.y),
    z: sphereNormals.map(p => p.z),
    marker: { size: 3, color: 'black' },
    name: 'Mapped Normals'
  };

  const layout = {
    title: `Gauss Map (freq=${freq}, amp=${amp})`,
    margin: { t: 50 },
    grid: { rows: 1, columns: 2, pattern: 'independent' },
    showlegend: false,
    scene: {
      domain: { x: [0, 0.45] },
      aspectmode: 'cube'
    },
    scene2: {
      domain: { x: [0.55, 1.0] },
      aspectmode: 'cube'
    }
  };

  const data = [
    { ...surfaceTrace, scene: 'scene' },
    { ...normalsTrace, scene: 'scene' },
    { ...sphereTrace, scene: 'scene2' },
    { ...normalPoints, scene: 'scene2' }
  ];

  Plotly.newPlot('plot', data, layout);
}

document.getElementById('freqSlider').addEventListener('input', () => {
  const freq = parseFloat(document.getElementById('freqSlider').value);
  const amp = parseFloat(document.getElementById('ampSlider').value);
  plotGaussMap(freq, amp);
});

document.getElementById('ampSlider').addEventListener('input', () => {
  const freq = parseFloat(document.getElementById('freqSlider').value);
  const amp = parseFloat(document.getElementById('ampSlider').value);
  plotGaussMap(freq, amp);
});

plotGaussMap(1.0, 1.0);
</script>

</body>
</html>
