
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Gauss Map Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<h2>Interactive Gauss Map Visualization</h2>

<div>
    <label for="frequency">Frequency:</label>
    <input type="range" id="frequency" min="0.1" max="5.0" step="0.1" value="1">
    <span id="freq-value">1.0</span>
</div>
<div>
    <label for="amplitude">Amplitude:</label>
    <input type="range" id="amplitude" min="0.1" max="5.0" step="0.1" value="1">
    <span id="amp-value">1.0</span>
</div>

<div id="surface-plot" style="width: 48%; display: inline-block;"></div>
<div id="sphere-plot" style="width: 48%; display: inline-block;"></div>

<script>
function computeSurfaceData(freq, amp) {
    const x = [], y = [], z = [], u = [], v = [], w = [];
    const sphereU = [], sphereV = [], sphereW = [];

    const steps = 20;
    for (let i = 0; i < steps; i++) {
        x[i] = [];
        y[i] = [];
        z[i] = [];

        for (let j = 0; j < steps; j++) {
            const xi = -1 + 2 * i / (steps - 1);
            const yj = -1 + 2 * j / (steps - 1);
            x[i][j] = xi;
            y[i][j] = yj;
            z[i][j] = amp * Math.sin(freq * Math.PI * xi) * Math.cos(freq * Math.PI * yj);

            // Gradients (dz/dx, dz/dy)
            const dzdx = amp * freq * Math.PI * Math.cos(freq * Math.PI * xi) * Math.cos(freq * Math.PI * yj);
            const dzdy = -amp * freq * Math.PI * Math.sin(freq * Math.PI * xi) * Math.sin(freq * Math.PI * yj);

            // Normal vector
            let nx = -dzdx, ny = -dzdy, nz = 1.0;
            const mag = Math.sqrt(nx * nx + ny * ny + nz * nz);
            nx /= mag; ny /= mag; nz /= mag;

            u.push(nx); v.push(ny); w.push(nz);  // normals on surface
            sphereU.push(nx); sphereV.push(ny); sphereW.push(nz);  // normals on sphere
        }
    }

    return { x, y, z, u, v, w, sphereU, sphereV, sphereW };
}

function drawPlots(freq, amp) {
    const { x, y, z, u, v, w, sphereU, sphereV, sphereW } = computeSurfaceData(freq, amp);
    const flatX = [].concat(...x), flatY = [].concat(...y), flatZ = [].concat(...z);

    // Surface with normals
    const surfaceTrace = {
        type: 'surface',
        x: x, y: y, z: z,
        colorscale: 'Viridis',
        opacity: 0.7
    };
    const vectorTrace = {
        type: 'cone',
        x: flatX,
        y: flatY,
        z: flatZ,
        u: u,
        v: v,
        w: w,
        sizemode: "absolute",
        sizeref: 0.4,
        anchor: "tail",
        showscale: false,
        colorscale: [[0, 'red'], [1, 'red']]
    };

    Plotly.newPlot("surface-plot", [surfaceTrace, vectorTrace], {
        title: "Surface with Normals",
        scene: { aspectmode: "cube" }
    });

    // Gauss map on unit sphere
    const sphereTrace = {
        type: 'surface',
        x: [], y: [], z: [],
        opacity: 0.3,
        surfacecolor: [],
        showscale: false
    };

    const steps = 30;
    for (let i = 0; i <= steps; i++) {
        const theta = i * Math.PI / steps;
        const rowX = [], rowY = [], rowZ = [];
        for (let j = 0; j <= steps; j++) {
            const phi = j * 2 * Math.PI / steps;
            rowX.push(Math.sin(theta) * Math.cos(phi));
            rowY.push(Math.sin(theta) * Math.sin(phi));
            rowZ.push(Math.cos(theta));
        }
        sphereTrace.x.push(rowX);
        sphereTrace.y.push(rowY);
        sphereTrace.z.push(rowZ);
    }

    const normalsTrace = {
        type: 'cone',
        x: Array(sphereU.length).fill(0),
        y: Array(sphereV.length).fill(0),
        z: Array(sphereW.length).fill(0),
        u: sphereU,
        v: sphereV,
        w: sphereW,
        sizemode: "absolute",
        sizeref: 0.4,
        anchor: "tail",
        showscale: false,
        colorscale: [[0, 'red'], [1, 'red']]
    };

    Plotly.newPlot("sphere-plot", [sphereTrace, normalsTrace], {
        title: "Gauss Map (Normals on Unit Sphere)",
        scene: {
            aspectmode: "cube",
            xaxis: { range: [-1.1, 1.1] },
            yaxis: { range: [-1.1, 1.1] },
            zaxis: { range: [-1.1, 1.1] }
        }
    });
}

document.getElementById("frequency").addEventListener("input", function() {
    const freq = parseFloat(this.value);
    const amp = parseFloat(document.getElementById("amplitude").value);
    document.getElementById("freq-value").innerText = freq.toFixed(1);
    drawPlots(freq, amp);
});

document.getElementById("amplitude").addEventListener("input", function() {
    const amp = parseFloat(this.value);
    const freq = parseFloat(document.getElementById("frequency").value);
    document.getElementById("amp-value").innerText = amp.toFixed(1);
    drawPlots(freq, amp);
});

drawPlots(1.0, 1.0);
</script>

</body>
</html>
