<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Gauss Map Visualization</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<h2>Interactive Gauss Map Visualization</h2>
<label for="freqSlider">Frequency:</label>
<input type="range" id="freqSlider" min="0.1" max="3.0" step="0.1" value="1.0">
<span id="freqValue">1.0</span>
&nbsp;&nbsp;
<label for="ampSlider">Amplitude:</label>
<input type="range" id="ampSlider" min="0.1" max="3.0" step="0.1" value="1.0">
<span id="ampValue">1.0</span>

<div id="plot" style="display: flex;"></div>

<script>
function generateData(freq, amp) {
    const resolution = 60;
    const x = [], y = [], z = [], nx = [], ny = [], nz = [], px = [], py = [], pz = [];
    for (let i = 0; i < resolution; i++) {
        let xi = -1 + 2 * i / (resolution - 1);
        for (let j = 0; j < resolution; j++) {
            let yj = -1 + 2 * j / (resolution - 1);

            const fz = amp * Math.sin(freq * Math.PI * xi) * Math.cos(freq * Math.PI * yj);
            const fx = amp * freq * Math.PI * Math.cos(freq * Math.PI * xi) * Math.cos(freq * Math.PI * yj);
            const fy = -amp * freq * Math.PI * Math.sin(freq * Math.PI * xi) * Math.sin(freq * Math.PI * yj);

            // Store surface point
            x.push(xi);
            y.push(yj);
            z.push(fz);

            // Compute normalized normal vector
            let nx_i = -fx, ny_i = -fy, nz_i = 1;
            let norm = Math.sqrt(nx_i ** 2 + ny_i ** 2 + nz_i ** 2);
            nx_i /= norm;
            ny_i /= norm;
            nz_i /= norm;
            
            // Store normal vector for quiver
            nx.push(nx_i);
            ny.push(ny_i);
            nz.push(nz_i);

            // Mapped points on unit sphere (Gauss map)
            px.push(nx_i);
            py.push(ny_i);
            pz.push(nz_i);
        }
    }
    return {x, y, z, nx, ny, nz, px, py, pz};
}

function plot(freq, amp) {
    document.getElementById('freqValue').textContent = freq;
    document.getElementById('ampValue').textContent = amp;

    const {x, y, z, nx, ny, nz, px, py, pz} = generateData(freq, amp);

    const surfaceTrace = {
        type: 'mesh3d', x, y, z,
        intensity: z,
        colorscale: 'Viridis',
        opacity: 0.7,
        name: 'Surface'
    };

    const normalTrace = {
        type: 'cone',
        x, y, z,
        u: nx, v: ny, w: nz,
        sizemode: 'absolute', sizeref: 0.3,
        anchor: 'tail',
        colorscale: [[0, 'red'], [1, 'red']],
        showscale: false,
        name: 'Normals'
    };

    const sphereTrace = {
        type: 'surface',
        x: [], y: [], z: [],
        opacity: 0.3,
        colorscale: 'RdBu',
        showscale: false
    };

    const SPHERE_RES = 60;
    for (let i = 0; i < SPHERE_RES; i++) {
        let theta = 2 * Math.PI * i / SPHERE_RES;
        let xRow = [], yRow = [], zRow = [];
        for (let j = 0; j < SPHERE_RES; j++) {
            let phi = Math.PI * j / (SPHERE_RES - 1);
            xRow.push(Math.sin(phi) * Math.cos(theta));
            yRow.push(Math.sin(phi) * Math.sin(theta));
            zRow.push(Math.cos(phi));
        }
        sphereTrace.x.push(xRow);
        sphereTrace.y.push(yRow);
        sphereTrace.z.push(zRow);
    }

    const normalPoints = {
        type: 'scatter3d',
        mode: 'markers',
        x: px,
        y: py,
        z: pz,
        marker: {
            size: 3,
            color: 'black'
        },
        name: 'Mapped Normals'
    };

    const layout = {
        title: `Gauss Map (freq=${freq}, amp=${amp})`,
        grid: {rows: 1, columns: 2, pattern: 'independent'},
        margin: {l: 0, r: 0, t: 40, b: 0},
        scene: {
            domain: {x: [0, 0.48]},
            title: 'Surface with Normals',
            xaxis: {title: 'x'}, yaxis: {title: 'y'}, zaxis: {title: 'z'}
        },
        scene2: {
            domain: {x: [0.52, 1]},
            title: 'Gauss Map (Normals on Unit Sphere)',
            xaxis: {title: 'x', range: [-1.1, 1.1]},
            yaxis: {title: 'y', range: [-1.1, 1.1]},
            zaxis: {title: 'z', range: [-1.1, 1.1]}
        }
    };

    Plotly.newPlot('plot', [surfaceTrace, normalTrace, sphereTrace, normalPoints], layout);
}

// Initial plot
plot(1.0, 1.0);

// Hook up sliders
const freqSlider = document.getElementById('freqSlider');
const ampSlider = document.getElementById('ampSlider');

freqSlider.addEventListener('input', () => plot(parseFloat(freqSlider.value), parseFloat(ampSlider.value)));
ampSlider.addEventListener('input', () => plot(parseFloat(freqSlider.value), parseFloat(ampSlider.value)));
</script>
</body>
</html>
